<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Place Update</title>
    <link th:href="@{/css/placeUpdate.css}" rel="stylesheet">
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            fetch("/data/regions.json") // JSON íŒŒì¼ ê°€ì ¸ì˜¤ê¸°
                .then(response => response.json())
                .then(data => {
                    let provinceSelect = document.getElementById("province");
                    let citySelect = document.getElementById("city");

                    let initialProvince = provinceSelect.getAttribute("data-initial");
                    let initialCity = citySelect.getAttribute("data-initial");

                    console.log("ì´ˆê¸° ì‹œ/ë„:", initialProvince); // ë””ë²„ê¹…
                    console.log("ì´ˆê¸° ì‹œ/êµ°/êµ¬:", initialCity);

                    // ğŸ“Œ ì‹œ/ë„ ì˜µì…˜ ì¶”ê°€
                    Object.keys(data).forEach(province => {
                        let option = document.createElement("option");
                        option.value = province;
                        option.textContent = province;
                        provinceSelect.appendChild(option);
                    });

                    // ğŸ“Œ ê¸°ì¡´ ì‹œ/ë„ ê°’ ì„¤ì • í›„ ë„ì‹œ ì—…ë°ì´íŠ¸
                    if (initialProvince && data[initialProvince]) {
                        provinceSelect.value = initialProvince;
                        updateCities(initialProvince, initialCity);
                    }

                    // ğŸ“Œ ì‹œ/ë„ ë³€ê²½ ì‹œ ì‹œ/êµ°/êµ¬ ì˜µì…˜ ì—…ë°ì´íŠ¸
                    provinceSelect.addEventListener("change", function () {
                        updateCities(this.value);
                    });

                    function updateCities(selectedProvince, selectedCity = null) {
                        citySelect.innerHTML = "<option value=''>ì‹œ/êµ°/êµ¬ ì„ íƒ</option>";

                        if (selectedProvince && data[selectedProvince]) {
                            data[selectedProvince].forEach(city => {
                                let option = document.createElement("option");
                                option.value = city;
                                option.textContent = city;
                                citySelect.appendChild(option);
                            });

                            // ğŸ“Œ ê¸°ì¡´ ì‹œ/êµ°/êµ¬ ê°’ ìœ ì§€
                            if (selectedCity && data[selectedProvince].includes(selectedCity)) {
                                citySelect.value = selectedCity;
                            }
                        }
                    }
                })
                .catch(error => {
                    console.error("JSON ë¡œë“œ ì˜¤ë¥˜:", error);
                    alert("ì§€ì—­ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                });
        });
    </script>
</head>
<body>
<form id="updateForm" th:action="@{'/place/' + ${placeId} + '/update'}" method="post" th:object="${updateData}">
    <label>ì´ë¦„:</label>
    <input type="text" id="name" th:field="*{name}" required />
    <br>
    <span th:if="${#fields.hasErrors('name')}" th:each="err : ${#fields.errors('name')}" style="color: red; display: block;">[[${err}]]</span>

    <label>ì„¤ëª…:</label>
    <textarea id="description" th:field="*{description}" required></textarea>
    <br>
    <span th:if="${#fields.hasErrors('description')}" th:each="err : ${#fields.errors('description')}" style="color: red; display: block;">[[${err}]]</span>

    <label>ì‹œ/ë„ ì„ íƒ:</label>
    <select id="province" th:field="*{province}" th:attr="data-initial=${updateData.province}" required>
        <option value="">ì‹œ/ë„ ì„ íƒ</option>
    </select>

    <label>ì‹œ/êµ°/êµ¬ ì„ íƒ:</label>
    <select id="city" th:field="*{city}" th:attr="data-initial=${updateData.city}" required>
        <option value="">ì‹œ/êµ°/êµ¬ ì„ íƒ</option>
    </select>

    <label>ìƒì„¸ ì£¼ì†Œ:</label>
    <input type="text" id="detailAddress" name="detailAddress" th:field="*{detailAddress}" required />
    <br>

    <label>ì—°ë½ì²˜:</label>
    <input type="text" id="contact" th:field="*{contact}" required />
    <br>
    <span th:if="${#fields.hasErrors('contact')}" th:each="err : ${#fields.errors('contact')}" style="color: red; display: block;">[[${err}]]</span>

    <button type="submit">ìˆ˜ì •</button>
</form>
</body>
</html>
