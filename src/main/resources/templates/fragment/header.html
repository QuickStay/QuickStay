<!-- fragments/header.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:fragment="header">
    <meta charset="UTF-8">
    <title>Header</title>
    <link th:href="@{/css/header.css}" rel="stylesheet">
</head>
<body>
<header>
    <div class="header-container">
        <!-- ë¡œê³  -->
        <div class="logo">
            <a th:href="@{/home}">
                <img th:src="@{/images/logo.png}" alt="ë¡œê³ ">
            </a>
        </div>

        <!-- ê²€ìƒ‰ ì°½ -->
        <div class="search-box" style="position: relative;">
            <form th:action="@{/place/search}" method="get">
                <input
                        type="text"
                        name="keyword"
                        placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                        onclick="showDropdown()"
                >
                <button type="submit">ê²€ìƒ‰</button>
            </form>

            <!-- ë™ì ìœ¼ë¡œ ëœ¨ëŠ” ë°•ìŠ¤ -->
            <div id="dropdown" style="
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        background: white;
        border: 1px solid #ccc;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        padding: 10px;
        z-index: 1000;
    ">
                <select id="region-select" onchange="updateSubregions()" style="width: 100%; margin-bottom: 10px;">
                    <option value="">ì‹œ/ë„ ì„ íƒ</option>
                </select>
                <select id="subregion-select" style="width: 100%;">
                    <option value="">ì‹œ/êµ¬/êµ° ì„ íƒ</option>
                </select>
            </div>
        </div>

        <script>
            let regions = {};

            fetch('/data/regions.json') // â˜… ê²½ë¡œ ìˆ˜ì •
                .then(response => response.json())
                .then(data => {
                    regions = data;
                    populateRegions();
                });

            function populateRegions() {
                const regionSelect = document.getElementById('region-select');
                for (let region in regions) {
                    const option = document.createElement('option');
                    option.value = region;
                    option.textContent = region;
                    regionSelect.appendChild(option);
                }
            }

            function updateSubregions() {
                const regionSelect = document.getElementById('region-select');
                const subregionSelect = document.getElementById('subregion-select');
                const selectedRegion = regionSelect.value;

                subregionSelect.innerHTML = '<option value="">ì‹œ/êµ¬/êµ° ì„ íƒ</option>';

                if (regions[selectedRegion]) {
                    regions[selectedRegion].forEach(sub => {
                        const option = document.createElement('option');
                        option.value = sub;
                        option.textContent = sub;
                        subregionSelect.appendChild(option);
                    });
                }
            }

            function showDropdown() {
                document.getElementById('dropdown').style.display = 'block';
            }

            document.addEventListener('click', function(event) {
                const dropdown = document.getElementById('dropdown');
                const searchBox = document.querySelector('.search-box');

                if (!searchBox.contains(event.target)) {
                    dropdown.style.display = 'none';
                }
            });

            // ğŸ”¥ ì¶”ê°€! ì‹œ/êµ° ì„ íƒí•˜ë©´ inputì— ì±„ì›Œë„£ê¸°
            document.getElementById('subregion-select').addEventListener('change', function() {
                const region = document.getElementById('region-select').value;
                const subregion = document.getElementById('subregion-select').value;

                if (region && subregion) {
                    document.querySelector('input[name="keyword"]').value = region + ' ' + subregion;
                    document.getElementById('dropdown').style.display = 'none'; // ì„ íƒ ëë‚˜ë©´ ì°½ ë‹«ê¸°
                }
            });
        </script>





        <!-- ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ -->
        <div class="auth-links">
            <!-- ë¡œê·¸ì¸ ìƒíƒœì¼ ë•Œ -->
            <span th:if="${session.loginUser != null}">
                <span th:text="${session.loginUser.nickname} + 'ë‹˜ ì•ˆë…•í•˜ì„¸ìš”'"></span>
                <a th:href="@{/myPage}">ë§ˆì´í˜ì´ì§€</a>
                <a th:href="@{/logout}">ë¡œê·¸ì•„ì›ƒ</a>
            </span>

            <!-- ë¡œê·¸ì¸ ìƒíƒœê°€ ì•„ë‹ ë•Œ -->
            <span th:if="${session.loginUser == null}">
                <a th:href="@{/login}">ë¡œê·¸ì¸</a>
            </span>
        </div>
    </div>
</header>
</body>
</html>
